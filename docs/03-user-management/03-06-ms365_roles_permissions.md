# 3.6 ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ­ãƒ¼ãƒ«ã¨æ¨©é™ç®¡ç†

---

## ğŸ“– å­¦ç¿’ç›®æ¨™

Microsoft 365ç’°å¢ƒã«ãŠã‘ã‚‹é©åˆ‡ãªæ¨©é™è¨­è¨ˆã¨ç®¡ç†æ‰‹æ³•ã‚’ç¿’å¾—ã—ã€æœ€å°æ¨©é™ã®åŸå‰‡ã«åŸºã¥ã„ãŸã‚»ã‚­ãƒ¥ã‚¢ã§åŠ¹ç‡çš„ãªæ¨©é™ä½“ç³»ã‚’æ§‹ç¯‰ã§ãã‚‹ã‚¹ã‚­ãƒ«ã‚’èº«ã«ã¤ã‘ã¾ã™ã€‚

### ğŸ¯ ã“ã®ç¯€ã§ç¿’å¾—ã™ã‚‹ã“ã¨

- **ç®¡ç†è€…ãƒ­ãƒ¼ãƒ«ã®ç¨®é¡ã¨ç‰¹å¾´**ã‚’ç†è§£ã—ã€é©åˆ‡ãªæ¨©é™åˆ†é›¢ãŒã§ãã‚‹
- **æœ€å°æ¨©é™ã®åŸå‰‡**ã‚’å®Ÿè·µã—ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒªã‚¹ã‚¯ã‚’æœ€å°åŒ–ã§ãã‚‹
- **ã‚«ã‚¹ã‚¿ãƒ ãƒ­ãƒ¼ãƒ«**ã®è¨­è¨ˆãƒ»ä½œæˆã«ã‚ˆã‚Šã€çµ„ç¹”å›ºæœ‰ã®è¦ä»¶ã«å¯¾å¿œã§ãã‚‹
- **Privileged Identity Management (PIM)**ã‚’æ´»ç”¨ã—ã€ç‰¹æ¨©ã‚¢ã‚¯ã‚»ã‚¹ã‚’å®‰å…¨ã«ç®¡ç†ã§ãã‚‹
- **æ¨©é™ç›£æŸ»ã¨è¦‹ç›´ã—**ãƒ—ãƒ­ã‚»ã‚¹ã‚’æ§‹ç¯‰ã—ã€ç¶™ç¶šçš„ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å‘ä¸Šã‚’å®Ÿç¾ã§ãã‚‹

### ğŸ’¼ å®Ÿå‹™ã§ã®æ´»ç”¨å ´é¢

- **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹**: ç›£æŸ»è¦ä»¶ã‚’æº€ãŸã™æ¨©é™è¨­è¨ˆã¨ç®¡ç†ä½“åˆ¶æ§‹ç¯‰
- **çµ„ç¹”å¤‰æ›´å¯¾å¿œ**: äººäº‹ç•°å‹•ãƒ»æ˜‡æ ¼ãƒ»é€€è·æ™‚ã®é©åˆ‡ãªæ¨©é™å¤‰æ›´å‡¦ç†
- **ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆå¯¾å¿œ**: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¾µå®³æ™‚ã®è¿…é€Ÿãªæ¨©é™ç„¡åŠ¹åŒ–ãƒ»å¾©æ—§
- **é‹ç”¨åŠ¹ç‡åŒ–**: æ¥­å‹™ã«å¿…è¦ãªæœ€å°é™ã®æ¨©é™ä»˜ä¸ã«ã‚ˆã‚‹ç”Ÿç”£æ€§å‘ä¸Š
- **æ•™è‚²æ©Ÿé–¢ç‰¹æœ‰**: å­¦æœŸåˆ¶ãƒ»å¹´åº¦åˆ¶ã«å¯¾å¿œã—ãŸå‹•çš„ãªæ¨©é™ç®¡ç†

---

## âš¡ å‰ææ¡ä»¶

### å¿…è¦ãªæ¨©é™ãƒ»ç’°å¢ƒ

- [ ] **Microsoft 365ãƒ†ãƒŠãƒ³ãƒˆ**ï¼ˆæœ¬ç•ªç’°å¢ƒã¾ãŸã¯ååˆ†ãªæ¨©é™ã‚’æŒã¤è©¦ç”¨ç‰ˆï¼‰
- [ ] **ã‚°ãƒ­ãƒ¼ãƒãƒ«ç®¡ç†è€…**æ¨©é™ã¾ãŸã¯**ç‰¹æ¨©ãƒ­ãƒ¼ãƒ«ç®¡ç†è€…**æ¨©é™
- [ ] **Microsoft Entra ID Premium P2**ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ï¼ˆPIMæ©Ÿèƒ½ä½¿ç”¨æ™‚ï¼‰
- [ ] **PowerShell 5.1ä»¥ä¸Š**ï¼ˆMicrosoft Graph PowerShell SDK v2.0+ï¼‰

### äº‹å‰æº–å‚™

```markdown
ğŸ“‹ æ¨©é™ç®¡ç†æº–å‚™ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ
- [ ] çµ„ç¹”ã®è·è²¬ãƒ»æ¥­å‹™ãƒ•ãƒ­ãƒ¼ã®è©³ç´°æŠŠæ¡
- [ ] ç¾åœ¨ã®æ¨©é™ä»˜ä¸çŠ¶æ³ã®æ£šå¸ã—
- [ ] ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒãƒªã‚·ãƒ¼ãƒ»ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹è¦ä»¶ã®ç¢ºèª
- [ ] ç·Šæ€¥æ™‚å¯¾å¿œæ‰‹é †ã®ç­–å®š
- [ ] æ¨©é™å¤‰æ›´æ‰¿èªãƒ—ãƒ­ã‚»ã‚¹ã®æ•´å‚™
- [ ] ç›£æŸ»ãƒ­ã‚°ä¿å­˜ãƒ»åˆ†æä½“åˆ¶ã®æ§‹ç¯‰
```

> ğŸ’¡ **é‡è¦**: æ¨©é™ç®¡ç†ã¯çµ„ç¹”ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®æ ¹å¹¹ã§ã™ã€‚å¤‰æ›´å‰ã«ã¯å¿…ãšå½±éŸ¿ç¯„å›²ã‚’ååˆ†ã«æ¤œè¨ã—ã€ãƒ†ã‚¹ãƒˆç’°å¢ƒã§ã®æ¤œè¨¼ã‚’è¡Œã£ã¦ãã ã•ã„ã€‚

---

## ğŸ” Microsoft 365 ç®¡ç†è€…ãƒ­ãƒ¼ãƒ«ã®ç†è§£

### ä¸»è¦ãªç®¡ç†è€…ãƒ­ãƒ¼ãƒ«ã¨è²¬ä»»ç¯„å›²

Microsoft 365ã§ã¯50ä»¥ä¸Šã®ç®¡ç†è€…ãƒ­ãƒ¼ãƒ«ãŒæä¾›ã•ã‚Œã¦ãŠã‚Šã€æ¥­å‹™è¦ä»¶ã«å¿œã˜ãŸé©åˆ‡ãªæ¨©é™åˆ†é›¢ãŒå¯èƒ½ã§ã™ã€‚

#### Tier 0ï¼ˆæœ€é«˜æ¨©é™ãƒ¬ãƒ™ãƒ«ï¼‰

| ãƒ­ãƒ¼ãƒ«å | ä¸»ãªæ¨©é™ç¯„å›² | é©ç”¨å¯¾è±¡ | ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒªã‚¹ã‚¯ |
|----------|-------------|----------|-------------------|
| **ã‚°ãƒ­ãƒ¼ãƒãƒ«ç®¡ç†è€…** | ãƒ†ãƒŠãƒ³ãƒˆå…¨ä½“ã®è¨­å®šãƒ»ç®¡ç† | CTOã€ITéƒ¨é•·ãƒ¬ãƒ™ãƒ« | â˜…â˜…â˜…â˜…â˜… |
| **ç‰¹æ¨©èªè¨¼ç®¡ç†è€…** | å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®èªè¨¼è¨­å®š | ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è²¬ä»»è€… | â˜…â˜…â˜…â˜…â˜… |
| **ç‰¹æ¨©ãƒ­ãƒ¼ãƒ«ç®¡ç†è€…** | ç®¡ç†è€…ãƒ­ãƒ¼ãƒ«å‰²ã‚Šå½“ã¦ | äººäº‹ãƒ»æ¨©é™ç®¡ç†è€… | â˜…â˜…â˜…â˜…â˜… |

```powershell
# Tier 0ãƒ­ãƒ¼ãƒ«ã®ç¾åœ¨ã®å‰²ã‚Šå½“ã¦çŠ¶æ³ç¢ºèª
$tier0Roles = @(
    "Global Administrator",
    "Privileged Authentication Administrator", 
    "Privileged Role Administrator"
)

foreach ($roleName in $tier0Roles) {
    $role = Get-MgDirectoryRole -Filter "displayName eq '$roleName'"
    if ($role) {
        $members = Get-MgDirectoryRoleMember -DirectoryRoleId $role.Id
        Write-Host "$roleName å‰²ã‚Šå½“ã¦æ•°: $($members.Count)å" -ForegroundColor Red
    }
}
```

#### Tier 1ï¼ˆé«˜æ¨©é™ãƒ¬ãƒ™ãƒ«ï¼‰

| ãƒ­ãƒ¼ãƒ«å | ä¸»ãªæ¨©é™ç¯„å›² | é©ç”¨å¯¾è±¡ | æ•™è‚²æ©Ÿé–¢ã§ã®æ´»ç”¨ |
|----------|-------------|----------|------------------|
| **Exchange ç®¡ç†è€…** | ãƒ¡ãƒ¼ãƒ«ãƒ»äºˆå®šè¡¨ç®¡ç† | ãƒ¡ãƒ¼ãƒ«ç®¡ç†è€… | æ•™å‹™ãƒ»äº‹å‹™ãƒ¡ãƒ¼ãƒ«ç®¡ç† |
| **SharePoint ç®¡ç†è€…** | ãƒ•ã‚¡ã‚¤ãƒ«å…±æœ‰ãƒ»ã‚µã‚¤ãƒˆç®¡ç† | æƒ…å ±ç®¡ç†è€… | æˆæ¥­è³‡æ–™ãƒ»ç ”ç©¶ãƒ‡ãƒ¼ã‚¿ç®¡ç† |
| **Teams ç®¡ç†è€…** | Teamsç’°å¢ƒå…¨ä½“ç®¡ç† | ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ç®¡ç†è€… | ã‚ªãƒ³ãƒ©ã‚¤ãƒ³æˆæ¥­ãƒ»ä¼šè­°ç®¡ç† |
| **Intune ç®¡ç†è€…** | ãƒ‡ãƒã‚¤ã‚¹ãƒ»ã‚¢ãƒ—ãƒªç®¡ç† | ãƒ‡ãƒã‚¤ã‚¹ç®¡ç†è€… | å­¦ç¿’ç”¨ãƒ‡ãƒã‚¤ã‚¹ç®¡ç† |

#### Tier 2ï¼ˆå°‚é–€æ¨©é™ãƒ¬ãƒ™ãƒ«ï¼‰

| ãƒ­ãƒ¼ãƒ«å | ä¸»ãªæ¨©é™ç¯„å›² | é©ç”¨å¯¾è±¡ | ä¸€èˆ¬ä¼æ¥­ã§ã®æ´»ç”¨ |
|----------|-------------|----------|------------------|
| **ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†è€…** | ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ»ã‚°ãƒ«ãƒ¼ãƒ—ç®¡ç† | äººäº‹ãƒ»ç·å‹™æ‹…å½“è€… | å¾“æ¥­å“¡ã‚¢ã‚«ã‚¦ãƒ³ãƒˆç®¡ç† |
| **ãƒ˜ãƒ«ãƒ—ãƒ‡ã‚¹ã‚¯ç®¡ç†è€…** | ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆãƒ»åŸºæœ¬ã‚µãƒãƒ¼ãƒˆ | IT ã‚µãƒãƒ¼ãƒˆæ‹…å½“ | æ—¥å¸¸çš„ãªãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚µãƒãƒ¼ãƒˆ |
| **ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ç®¡ç†è€…** | ãƒ©ã‚¤ã‚»ãƒ³ã‚¹å‰²ã‚Šå½“ã¦ç®¡ç† | IT ç®¡ç†è€… | ã‚³ã‚¹ãƒˆæœ€é©åŒ–ãƒ»ä½¿ç”¨çŠ¶æ³ç®¡ç† |
| **ãƒ¬ãƒãƒ¼ãƒˆé–²è¦§è€…** | ä½¿ç”¨çŠ¶æ³ãƒ¬ãƒãƒ¼ãƒˆé–²è¦§ | ç®¡ç†è·ãƒ»åˆ†ææ‹…å½“ | åˆ©ç”¨çŠ¶æ³åˆ†æãƒ»æ„æ€æ±ºå®šæ”¯æ´ |

### ãƒ­ãƒ¼ãƒ«åˆ¥æ¨©é™ãƒãƒˆãƒªãƒƒã‚¯ã‚¹

```markdown
ğŸ“Š æ¥­å‹™æ©Ÿèƒ½åˆ¥æ¨©é™ãƒãƒˆãƒªãƒƒã‚¯ã‚¹

| æ¥­å‹™æ©Ÿèƒ½ | ã‚°ãƒ­ãƒ¼ãƒãƒ«ç®¡ç†è€… | ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†è€… | Exchangeç®¡ç†è€… | ãƒ˜ãƒ«ãƒ—ãƒ‡ã‚¹ã‚¯ç®¡ç†è€… |
|----------|------------------|----------------|----------------|-------------------|
| ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆãƒ»å‰Šé™¤ | âœ… | âœ… | âŒ | âŒ |
| ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆ | âœ… | âœ… | âŒ | âœ… |
| ãƒ©ã‚¤ã‚»ãƒ³ã‚¹å‰²ã‚Šå½“ã¦ | âœ… | âœ… | âŒ | âŒ |
| ãƒ¡ãƒ¼ãƒ«ãƒœãƒƒã‚¯ã‚¹ç®¡ç† | âœ… | âŒ | âœ… | âŒ |
| ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®š | âœ… | âŒ | âŒ | âŒ |
| ç›£æŸ»ãƒ­ã‚°é–²è¦§ | âœ… | âŒ | âŒ | âŒ |
```

---

## ğŸ¯ æœ€å°æ¨©é™ã®åŸå‰‡ã¨å®Ÿè£…

### æ¨©é™è¨­è¨ˆã®åŸºæœ¬åŸå‰‡

#### 1. Need-to-KnowåŸå‰‡

**ğŸ¯ æ¦‚å¿µ**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯æ¥­å‹™é‚è¡Œã«å¿…è¦ãªæœ€å°é™ã®æƒ…å ±ãƒ»æ©Ÿèƒ½ã«ã®ã¿ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ã¨ã™ã‚‹

**å®Ÿè£…ä¾‹**:
```powershell
# éƒ¨ç½²åˆ¥ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ã®å®Ÿè£…
function Set-DepartmentBasedAccess {
    param($UserId, $Department)
    
    # éƒ¨ç½²åˆ¥ã‚°ãƒ«ãƒ¼ãƒ—å‰²ã‚Šå½“ã¦
    $departmentGroups = @{
        "æ•™å‹™éƒ¨" = @("Teachers-Group", "Curriculum-Access")
        "äº‹å‹™å±€" = @("Admin-Group", "Student-Records-Access")
        "ITéƒ¨" = @("IT-Support-Group", "System-Access")
    }
    
    if ($departmentGroups.ContainsKey($Department)) {
        foreach ($groupName in $departmentGroups[$Department]) {
            $group = Get-MgGroup -Filter "displayName eq '$groupName'"
            if ($group) {
                New-MgGroupMember -GroupId $group.Id -DirectoryObjectId $UserId
                Write-Host "âœ… $groupName ã«è¿½åŠ : $UserId" -ForegroundColor Green
            }
        }
    }
}
```

#### 2. Just-in-Time (JIT) ã‚¢ã‚¯ã‚»ã‚¹

**ğŸ¯ æ¦‚å¿µ**: é«˜æ¨©é™ã¯å¿…è¦ãªæ™‚é–“ã®ã¿æœ‰åŠ¹åŒ–ã—ã€ä½œæ¥­å®Œäº†å¾Œã¯è‡ªå‹•çš„ã«ç„¡åŠ¹åŒ–

**å®Ÿè£…**: Privileged Identity Management (PIM) ã®æ´»ç”¨

```powershell
# PIMã«ã‚ˆã‚‹ä¸€æ™‚çš„ãªæ¨©é™æ˜‡æ ¼
function Request-TemporaryAdminAccess {
    param(
        $UserId,
        $RoleName = "User Administrator",
        $DurationHours = 2,
        $Justification = "ç·Šæ€¥ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚µãƒãƒ¼ãƒˆå¯¾å¿œ"
    )
    
    # PIMãƒ­ãƒ¼ãƒ«å‰²ã‚Šå½“ã¦è¦æ±‚
    $roleDefinition = Get-MgRoleManagementDirectoryRoleDefinition -Filter "displayName eq '$RoleName'"
    
    $requestBody = @{
        RoleDefinitionId = $roleDefinition.Id
        PrincipalId = $UserId
        RequestType = "SelfActivate"
        ScheduleInfo = @{
            StartDateTime = (Get-Date).ToString("yyyy-MM-ddTHH:mm:ss.fffZ")
            Expiration = @{
                Type = "AfterDuration"
                Duration = "PT$($DurationHours)H"
            }
        }
        Justification = $Justification
    }
    
    try {
        $request = New-MgRoleManagementDirectoryRoleAssignmentScheduleRequest -BodyParameter $requestBody
        Write-Host "âœ… PIMæ¨©é™è¦æ±‚ãŒé€ä¿¡ã•ã‚Œã¾ã—ãŸ: $($request.Id)" -ForegroundColor Green
        return $request
    } catch {
        Write-Error "PIMè¦æ±‚ã«å¤±æ•—ã—ã¾ã—ãŸ: $($_.Exception.Message)"
    }
}
```

#### 3. æ¨©é™ã®åˆ†é›¢ã¨ç›£è¦–

**ğŸ¯ æ¦‚å¿µ**: é‡è¦ãªæ“ä½œã¯è¤‡æ•°äººã«ã‚ˆã‚‹æ‰¿èªã‚’è¦æ±‚ã—ã€å…¨ã¦ã®æ¨©é™å¤‰æ›´ã‚’ç›£è¦–

```powershell
# æ¨©é™å¤‰æ›´ã®ç›£è¦–ã‚·ã‚¹ãƒ†ãƒ 
function Monitor-PrivilegedRoleChanges {
    param([int]$DaysBack = 7)
    
    $startDate = (Get-Date).AddDays(-$DaysBack)
    
    # ç®¡ç†è€…ãƒ­ãƒ¼ãƒ«å¤‰æ›´ã®ç›£æŸ»
    $roleChanges = Get-MgAuditLogDirectoryAudit -Filter "activityDateTime ge $($startDate.ToString('yyyy-MM-dd')) and category eq 'RoleManagement'"
    
    $privilegedChanges = $roleChanges | Where-Object {
        $_.ActivityDisplayName -match "Add member to role|Remove member from role"
    } | Select-Object ActivityDateTime, ActivityDisplayName, InitiatedBy, TargetResources
    
    if ($privilegedChanges) {
        Write-Host "âš ï¸ éå»$DaysBackæ—¥é–“ã®æ¨©é™å¤‰æ›´:" -ForegroundColor Yellow
        $privilegedChanges | Format-Table -AutoSize
        
        # é«˜æ¨©é™ãƒ­ãƒ¼ãƒ«ã®å¤‰æ›´ã‚’ç‰¹ã«å¼·èª¿
        $criticalChanges = $privilegedChanges | Where-Object {
            $_.TargetResources.displayName -match "Global Administrator|Privileged"
        }
        
        if ($criticalChanges) {
            Write-Host "ğŸš¨ é‡è¦: é«˜æ¨©é™ãƒ­ãƒ¼ãƒ«ã®å¤‰æ›´ãŒæ¤œå‡ºã•ã‚Œã¾ã—ãŸ:" -ForegroundColor Red
            $criticalChanges | Format-Table -AutoSize
        }
    } else {
        Write-Host "âœ… æ¨©é™å¤‰æ›´ã¯ã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸ" -ForegroundColor Green
    }
    
    return $privilegedChanges
}
```

---

## ğŸ› ï¸ ã‚«ã‚¹ã‚¿ãƒ ãƒ­ãƒ¼ãƒ«ã®è¨­è¨ˆã¨ä½œæˆ

### çµ„ç¹”å›ºæœ‰ã®ãƒ­ãƒ¼ãƒ«è¦ä»¶åˆ†æ

æ•™è‚²æ©Ÿé–¢ã‚„ä¼æ¥­ã§ã¯ã€æ¨™æº–ãƒ­ãƒ¼ãƒ«ã§ã¯å¯¾å¿œã§ããªã„å›ºæœ‰ã®æ¨©é™è¦ä»¶ãŒå­˜åœ¨ã—ã¾ã™ã€‚

#### æ•™è‚²æ©Ÿé–¢å‘ã‘ã‚«ã‚¹ã‚¿ãƒ ãƒ­ãƒ¼ãƒ«ä¾‹

```powershell
# æ•™è‚²æ©Ÿé–¢å‘ã‘ã€Œå­¦å¹´ä¸»ä»»ã€ã‚«ã‚¹ã‚¿ãƒ ãƒ­ãƒ¼ãƒ«
function New-GradeLevelManagerRole {
    $roleName = "å­¦å¹´ä¸»ä»»ç®¡ç†è€…"
    $roleDescription = "ç‰¹å®šå­¦å¹´ã®å­¦ç”Ÿã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¨Teamsã‚¯ãƒ©ã‚¹ç®¡ç†æ¨©é™"
    
    # å¿…è¦ãªæ¨©é™ã®å®šç¾©
    $permissions = @(
        "microsoft.directory/users/basic/update",           # å­¦ç”ŸåŸºæœ¬æƒ…å ±æ›´æ–°
        "microsoft.directory/groups/members/update",        # ã‚¯ãƒ©ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—ç®¡ç†
        "microsoft.office365.skypeForBusiness/allEntities/allTasks", # Teamsç®¡ç†
        "microsoft.office365.serviceHealth/allEntities/allTasks"     # ã‚µãƒ¼ãƒ“ã‚¹çŠ¶æ³ç¢ºèª
    )
    
    # ã‚«ã‚¹ã‚¿ãƒ ãƒ­ãƒ¼ãƒ«ä½œæˆ
    $customRole = @{
        DisplayName = $roleName
        Description = $roleDescription
        IsEnabled = $true
        ResourceScopes = @("/")
        RolePermissions = @(
            @{
                AllowedResourceActions = $permissions
            }
        )
    }
    
    try {
        $newRole = New-MgRoleManagementDirectoryRoleDefinition -BodyParameter $customRole
        Write-Host "âœ… ã‚«ã‚¹ã‚¿ãƒ ãƒ­ãƒ¼ãƒ«ä½œæˆå®Œäº†: $roleName" -ForegroundColor Green
        return $newRole
    } catch {
        Write-Error "ã‚«ã‚¹ã‚¿ãƒ ãƒ­ãƒ¼ãƒ«ä½œæˆã«å¤±æ•—: $($_.Exception.Message)"
    }
}
```

#### ä¼æ¥­å‘ã‘ã‚«ã‚¹ã‚¿ãƒ ãƒ­ãƒ¼ãƒ«ä¾‹

```powershell
# ä¼æ¥­å‘ã‘ã€Œãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒªãƒ¼ãƒ€ãƒ¼ã€ã‚«ã‚¹ã‚¿ãƒ ãƒ­ãƒ¼ãƒ«
function New-ProjectLeaderRole {
    $roleName = "ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒªãƒ¼ãƒ€ãƒ¼"
    $roleDescription = "ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ¡ãƒ³ãƒãƒ¼ã®ç®¡ç†ã¨ãƒªã‚½ãƒ¼ã‚¹ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡"
    
    $permissions = @(
        "microsoft.directory/groups/basic/update",          # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚°ãƒ«ãƒ¼ãƒ—ç®¡ç†
        "microsoft.directory/groups/members/update",        # ãƒ¡ãƒ³ãƒãƒ¼è¿½åŠ ãƒ»å‰Šé™¤
        "microsoft.office365.sharepoint/allEntities/allTasks", # SharePointã‚µã‚¤ãƒˆç®¡ç†
        "microsoft.office365.exchange/allEntities/basic/read"  # ãƒ¡ãƒ¼ãƒ«é…å¸ƒãƒªã‚¹ãƒˆé–²è¦§
    )
    
    $customRole = @{
        DisplayName = $roleName
        Description = $roleDescription
        IsEnabled = $true
        ResourceScopes = @("/")
        RolePermissions = @(
            @{
                AllowedResourceActions = $permissions
            }
        )
    }
    
    $newRole = New-MgRoleManagementDirectoryRoleDefinition -BodyParameter $customRole
    Write-Host "âœ… ã‚«ã‚¹ã‚¿ãƒ ãƒ­ãƒ¼ãƒ«ä½œæˆå®Œäº†: $roleName" -ForegroundColor Green
    return $newRole
}
```

### ã‚¹ã‚³ãƒ¼ãƒ—åˆ¶é™ä»˜ããƒ­ãƒ¼ãƒ«

**ğŸ¯ æ¦‚å¿µ**: ç®¡ç†æ¨©é™ã‚’ç‰¹å®šã®ã‚°ãƒ«ãƒ¼ãƒ—ã‚„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«é™å®šã—ã€å½±éŸ¿ç¯„å›²ã‚’åˆ¶å¾¡

```powershell
# éƒ¨ç½²é™å®šç®¡ç†è€…ãƒ­ãƒ¼ãƒ«ã®ä½œæˆ
function New-DepartmentScopedAdminRole {
    param(
        $DepartmentName,
        $AdminUserId
    )
    
    # ç®¡ç†å¯¾è±¡ã¨ãªã‚‹éƒ¨ç½²ã‚°ãƒ«ãƒ¼ãƒ—ã‚’å–å¾—
    $departmentGroup = Get-MgGroup -Filter "displayName eq '$DepartmentName'"
    
    if ($departmentGroup) {
        # ç®¡ç†å˜ä½ï¼ˆAdministrative Unitï¼‰ã®ä½œæˆ
        $adminUnit = @{
            DisplayName = "$DepartmentName ç®¡ç†å˜ä½"
            Description = "$DepartmentName ã®é™å®šç®¡ç†ç¯„å›²"
        }
        
        $newAdminUnit = New-MgDirectoryAdministrativeUnit -BodyParameter $adminUnit
        
        # éƒ¨ç½²ãƒ¡ãƒ³ãƒãƒ¼ã‚’ç®¡ç†å˜ä½ã«è¿½åŠ 
        $departmentMembers = Get-MgGroupMember -GroupId $departmentGroup.Id
        foreach ($member in $departmentMembers) {
            New-MgDirectoryAdministrativeUnitMember -AdministrativeUnitId $newAdminUnit.Id -DirectoryObjectId $member.Id
        }
        
        # ã‚¹ã‚³ãƒ¼ãƒ—ä»˜ããƒ­ãƒ¼ãƒ«å‰²ã‚Šå½“ã¦
        $userAdminRole = Get-MgDirectoryRole -Filter "displayName eq 'User Administrator'"
        $scopedRoleAssignment = @{
            RoleDefinitionId = $userAdminRole.Id
            PrincipalId = $AdminUserId
            DirectoryScopeId = "/administrativeUnits/$($newAdminUnit.Id)"
        }
        
        New-MgRoleManagementDirectoryRoleAssignment -BodyParameter $scopedRoleAssignment
        
        Write-Host "âœ… éƒ¨ç½²é™å®šç®¡ç†è€…ã‚’è¨­å®šã—ã¾ã—ãŸ: $DepartmentName" -ForegroundColor Green
        return $newAdminUnit
    }
}
```

---

## ğŸ”„ å‹•çš„ã‚°ãƒ«ãƒ¼ãƒ—ã¨æ¨©é™ã®è‡ªå‹•åŒ–

### å±æ€§ãƒ™ãƒ¼ã‚¹ã®å‹•çš„æ¨©é™å‰²ã‚Šå½“ã¦

ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å±æ€§ï¼ˆéƒ¨ç½²ã€å½¹è·ã€å ´æ‰€ãªã©ï¼‰ã«åŸºã¥ã„ã¦ã€æ¨©é™ã‚’è‡ªå‹•çš„ã«ä»˜ä¸ãƒ»å‰¥å¥ªã™ã‚‹ã‚·ã‚¹ãƒ†ãƒ ã‚’æ§‹ç¯‰ã—ã¾ã™ã€‚

#### å‹•çš„ã‚°ãƒ«ãƒ¼ãƒ—ã«ã‚ˆã‚‹æ¨©é™ç®¡ç†

```powershell
# å±æ€§ãƒ™ãƒ¼ã‚¹ã®å‹•çš„ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ—ä½œæˆ
function New-DynamicSecurityGroup {
    param(
        $GroupName,
        $DynamicRule,
        $Description
    )
    
    $groupParams = @{
        DisplayName = $GroupName
        Description = $Description
        GroupTypes = @("DynamicMembership")
        SecurityEnabled = $true
        MailEnabled = $false
        MembershipRule = $DynamicRule
        MembershipRuleProcessingState = "On"
    }
    
    try {
        $newGroup = New-MgGroup -BodyParameter $groupParams
        Write-Host "âœ… å‹•çš„ã‚°ãƒ«ãƒ¼ãƒ—ä½œæˆå®Œäº†: $GroupName" -ForegroundColor Green
        
        # ã‚°ãƒ«ãƒ¼ãƒ—ãƒ¡ãƒ³ãƒãƒ¼ã‚·ãƒƒãƒ—ã®ç¢ºèªï¼ˆä½œæˆç›´å¾Œã¯ç©ºã®å ´åˆãŒã‚ã‚Šã¾ã™ï¼‰
        Start-Sleep -Seconds 5
        $memberCount = (Get-MgGroupMember -GroupId $newGroup.Id -All).Count
        Write-Host "ğŸ“Š ç¾åœ¨ã®ãƒ¡ãƒ³ãƒãƒ¼æ•°: $memberCount å" -ForegroundColor Cyan
        
        return $newGroup
    } catch {
        Write-Error "å‹•çš„ã‚°ãƒ«ãƒ¼ãƒ—ä½œæˆã«å¤±æ•—: $($_.Exception.Message)"
    }
}

# æ•™è‚²æ©Ÿé–¢å‘ã‘ã®å‹•çš„ã‚°ãƒ«ãƒ¼ãƒ—ä¾‹
function Create-EducationDynamicGroups {
    # 1. æ•™è·å“¡ã‚°ãƒ«ãƒ¼ãƒ—ï¼ˆå½¹è·ãŒæ•™æˆã€å‡†æ•™æˆã€è¬›å¸«ã€äº‹å‹™è·å“¡ã®å ´åˆï¼‰
    $facultyRule = '(user.jobTitle -eq "æ•™æˆ") -or (user.jobTitle -eq "å‡†æ•™æˆ") -or (user.jobTitle -eq "è¬›å¸«") -or (user.jobTitle -eq "äº‹å‹™è·å“¡")'
    New-DynamicSecurityGroup -GroupName "æ•™è·å“¡" -DynamicRule $facultyRule -Description "å…¨æ•™è·å“¡ã‚’å«ã‚€å‹•çš„ã‚°ãƒ«ãƒ¼ãƒ—"
    
    # 2. å­¦éƒ¨åˆ¥ã‚°ãƒ«ãƒ¼ãƒ—ï¼ˆéƒ¨ç½²å±æ€§ãƒ™ãƒ¼ã‚¹ï¼‰
    $departments = @("æƒ…å ±å­¦éƒ¨", "å·¥å­¦éƒ¨", "çµŒæ¸ˆå­¦éƒ¨", "æ–‡å­¦éƒ¨")
    foreach ($dept in $departments) {
        $deptRule = "user.department -eq `"$dept`""
        New-DynamicSecurityGroup -GroupName "$dept-å…¨å“¡" -DynamicRule $deptRule -Description "$dept ã®å…¨ãƒ¡ãƒ³ãƒãƒ¼"
    }
    
    # 3. æ–°å…¥ç”Ÿã‚°ãƒ«ãƒ¼ãƒ—ï¼ˆä½œæˆæ—¥ãƒ™ãƒ¼ã‚¹ï¼‰
    $currentYear = (Get-Date).Year
    $newStudentRule = "(user.jobTitle -eq `"å­¦ç”Ÿ`") -and (user.createdDateTime -ge `"$currentYear-04-01T00:00:00Z`")"
    New-DynamicSecurityGroup -GroupName "$currentYearå¹´åº¦æ–°å…¥ç”Ÿ" -DynamicRule $newStudentRule -Description "$currentYearå¹´åº¦ã®æ–°å…¥ç”Ÿ"
}

# ä¼æ¥­å‘ã‘ã®å‹•çš„ã‚°ãƒ«ãƒ¼ãƒ—ä¾‹
function Create-CorporateDynamicGroups {
    # 1. ç®¡ç†è·ã‚°ãƒ«ãƒ¼ãƒ—
    $managerRule = '(user.jobTitle -contains "éƒ¨é•·") -or (user.jobTitle -contains "èª²é•·") -or (user.jobTitle -contains "ä¿‚é•·") -or (user.jobTitle -contains "ä¸»ä»»")'
    New-DynamicSecurityGroup -GroupName "ç®¡ç†è·" -DynamicRule $managerRule -Description "å…¨ç®¡ç†è·ã‚’å«ã‚€å‹•çš„ã‚°ãƒ«ãƒ¼ãƒ—"
    
    # 2. ãƒªãƒ¢ãƒ¼ãƒˆãƒ¯ãƒ¼ã‚«ãƒ¼ã‚°ãƒ«ãƒ¼ãƒ—ï¼ˆå‹¤å‹™åœ°ãƒ™ãƒ¼ã‚¹ï¼‰
    $remoteRule = '(user.physicalDeliveryOfficeName -eq "åœ¨å®…") -or (user.physicalDeliveryOfficeName -eq "ã‚µãƒ†ãƒ©ã‚¤ãƒˆ")'
    New-DynamicSecurityGroup -GroupName "ãƒªãƒ¢ãƒ¼ãƒˆãƒ¯ãƒ¼ã‚«ãƒ¼" -DynamicRule $remoteRule -Description "ãƒªãƒ¢ãƒ¼ãƒˆå‹¤å‹™è€…å‘ã‘ã‚°ãƒ«ãƒ¼ãƒ—"
    
    # 3. å¥‘ç´„ç¤¾å“¡ãƒ»æ´¾é£ç¤¾å“¡ã‚°ãƒ«ãƒ¼ãƒ—
    $contractRule = '(user.employeeType -eq "å¥‘ç´„ç¤¾å“¡") -or (user.employeeType -eq "æ´¾é£ç¤¾å“¡")'
    New-DynamicSecurityGroup -GroupName "éæ­£è¦é›‡ç”¨è€…" -DynamicRule $contractRule -Description "å¥‘ç´„ãƒ»æ´¾é£ç¤¾å“¡ã‚°ãƒ«ãƒ¼ãƒ—"
}
```

### æ¡ä»¶ä»˜ãã‚¢ã‚¯ã‚»ã‚¹ãƒãƒªã‚·ãƒ¼ã¨ã®é€£æº

å‹•çš„ã‚°ãƒ«ãƒ¼ãƒ—ã¨æ¡ä»¶ä»˜ãã‚¢ã‚¯ã‚»ã‚¹ã‚’çµ„ã¿åˆã‚ã›ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã¨åˆ©ä¾¿æ€§ã‚’ä¸¡ç«‹ã—ã¾ã™ã€‚

```powershell
# æ¡ä»¶ä»˜ãã‚¢ã‚¯ã‚»ã‚¹ãƒãƒªã‚·ãƒ¼ã®ä½œæˆï¼ˆå‹•çš„ã‚°ãƒ«ãƒ¼ãƒ—ãƒ™ãƒ¼ã‚¹ï¼‰
function New-ConditionalAccessPolicy {
    param(
        $PolicyName,
        $TargetGroupId,
        $Requirements
    )
    
    $policy = @{
        DisplayName = $PolicyName
        State = "enabled"
        Conditions = @{
            Users = @{
                IncludeGroups = @($TargetGroupId)
                ExcludeUsers = @()
            }
            Applications = @{
                IncludeApplications = @("All")
            }
            Locations = @{
                IncludeLocations = @("All")
                ExcludeLocations = @("AllTrusted")
            }
        }
        GrantControls = @{
            Operator = "OR"
            BuiltInControls = $Requirements
        }
    }
    
    try {
        $newPolicy = New-MgIdentityConditionalAccessPolicy -BodyParameter $policy
        Write-Host "âœ… æ¡ä»¶ä»˜ãã‚¢ã‚¯ã‚»ã‚¹ãƒãƒªã‚·ãƒ¼ä½œæˆå®Œäº†: $PolicyName" -ForegroundColor Green
        return $newPolicy
    } catch {
        Write-Error "ãƒãƒªã‚·ãƒ¼ä½œæˆã«å¤±æ•—: $($_.Exception.Message)"
    }
}

# æ•™è‚²æ©Ÿé–¢å‘ã‘ãƒãƒªã‚·ãƒ¼ä¾‹
function Create-EducationConditionalAccessPolicies {
    # å­¦ç”Ÿã‚°ãƒ«ãƒ¼ãƒ—ã®å–å¾—
    $studentsGroup = Get-MgGroup -Filter "displayName eq 'å­¦ç”Ÿ'"
    
    if ($studentsGroup) {
        # å­¦ç”Ÿå‘ã‘: å¤šè¦ç´ èªè¨¼å¿…é ˆ
        New-ConditionalAccessPolicy -PolicyName "å­¦ç”Ÿ-MFAå¿…é ˆ" -TargetGroupId $studentsGroup.Id -Requirements @("mfa")
        
        # æ•™è·å“¡å‘ã‘: MFA + æº–æ‹ ãƒ‡ãƒã‚¤ã‚¹å¿…é ˆ
        $facultyGroup = Get-MgGroup -Filter "displayName eq 'æ•™è·å“¡'"
        if ($facultyGroup) {
            New-ConditionalAccessPolicy -PolicyName "æ•™è·å“¡-é«˜ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£" -TargetGroupId $facultyGroup.Id -Requirements @("mfa", "compliantDevice")
        }
    }
}
```

---

## ğŸ” æ¨©é™ç›£æŸ»ã¨ç¶™ç¶šçš„ãªæ”¹å–„

### å®šæœŸçš„ãªæ¨©é™æ£šå¸ã—

**ğŸ¯ ç›®çš„**: ä¸è¦ãªæ¨©é™ã®ç‰¹å®šãƒ»å‰Šé™¤ã¨ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹è¦ä»¶ã®ç¶­æŒ

```powershell
# åŒ…æ‹¬çš„ãªæ¨©é™ç›£æŸ»ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
function Generate-ComprehensiveAccessAudit {
    param(
        [string]$OutputPath = "C:\Reports\AccessAudit_$(Get-Date -Format 'yyyyMMdd').xlsx"
    )
    
    Write-Host "ğŸ” æ¨©é™ç›£æŸ»ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆã‚’é–‹å§‹ã—ã¾ã™..." -ForegroundColor Cyan
    
    # 1. ç®¡ç†è€…ãƒ­ãƒ¼ãƒ«å‰²ã‚Šå½“ã¦çŠ¶æ³
    $adminRoleReport = @()
    $adminRoles = Get-MgDirectoryRole | Where-Object {$_.DisplayName -match "Administrator|ç®¡ç†è€…"}
    
    foreach ($role in $adminRoles) {
        $members = Get-MgDirectoryRoleMember -DirectoryRoleId $role.Id
        foreach ($member in $members) {
            $user = Get-MgUser -UserId $member.Id -ErrorAction SilentlyContinue
            if ($user) {
                $lastSignIn = $user.SignInActivity.LastSignInDateTime
                $daysSinceLastSignIn = if ($lastSignIn) { 
                    (Get-Date) - [datetime]$lastSignIn | Select-Object -ExpandProperty TotalDays 
                } else { 
                    999 
                }
                
                $adminRoleReport += [PSCustomObject]@{
                    RoleName = $role.DisplayName
                    UserName = $user.DisplayName
                    UserPrincipalName = $user.UserPrincipalName
                    Department = $user.Department
                    JobTitle = $user.JobTitle
                    AccountEnabled = $user.AccountEnabled
                    LastSignIn = $lastSignIn
                    DaysSinceLastSignIn = [math]::Round($daysSinceLastSignIn)
                    RiskLevel = if ($daysSinceLastSignIn -gt 90) { "é«˜" } elseif ($daysSinceLastSignIn -gt 30) { "ä¸­" } else { "ä½" }
                }
            }
        }
    }
    
    # 2. é«˜æ¨©é™ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®åˆ†æ
    $highPrivilegedUsers = $adminRoleReport | Group-Object UserPrincipalName | Where-Object {$_.Count -gt 1}
    
    Write-Host "ğŸ“Š ç›£æŸ»çµæœã‚µãƒãƒªãƒ¼:" -ForegroundColor Yellow
    Write-Host "  ç®¡ç†è€…ãƒ­ãƒ¼ãƒ«ä¿æœ‰è€…: $($adminRoleReport.Count)å" -ForegroundColor White
    Write-Host "  è¤‡æ•°ãƒ­ãƒ¼ãƒ«ä¿æœ‰è€…: $($highPrivilegedUsers.Count)å" -ForegroundColor White
    
    $inactiveAdmins = $adminRoleReport | Where-Object {$_.DaysSinceLastSignIn -gt 90}
    if ($inactiveAdmins) {
        Write-Host "  âš ï¸ 90æ—¥ä»¥ä¸Šæœªã‚µã‚¤ãƒ³ã‚¤ãƒ³ç®¡ç†è€…: $($inactiveAdmins.Count)å" -ForegroundColor Red
        $inactiveAdmins | ForEach-Object {
            Write-Host "    - $($_.UserPrincipalName) ($($_.RoleName))" -ForegroundColor Red
        }
    }
    
    # 3. ã‚²ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ¨©é™çŠ¶æ³
    $guestUsers = Get-MgUser -Filter "userType eq 'Guest'" -All
    $guestWithRoles = @()
    
    foreach ($guest in $guestUsers) {
        $guestRoles = Get-MgUserMemberOf -UserId $guest.Id | Where-Object {$_.AdditionalProperties."@odata.type" -eq "#microsoft.graph.directoryRole"}
        if ($guestRoles) {
            $guestWithRoles += [PSCustomObject]@{
                GuestEmail = $guest.UserPrincipalName
                DisplayName = $guest.DisplayName
                Roles = ($guestRoles.AdditionalProperties.displayName -join "; ")
                CreatedDate = $guest.CreatedDateTime
                LastSignIn = $guest.SignInActivity.LastSignInDateTime
            }
        }
    }
    
    # 4. PIMå¯¾è±¡ãƒ­ãƒ¼ãƒ«ã®çŠ¶æ³ï¼ˆPremium P2ãƒ©ã‚¤ã‚»ãƒ³ã‚¹å¿…è¦ï¼‰
    try {
        $pimEligibleAssignments = Get-MgRoleManagementDirectoryRoleEligibilityScheduleInstance -All
        $pimActiveAssignments = Get-MgRoleManagementDirectoryRoleAssignmentScheduleInstance -All
        
        Write-Host "  PIMå¯¾è±¡å‰²ã‚Šå½“ã¦: $($pimEligibleAssignments.Count)ä»¶" -ForegroundColor Cyan
        Write-Host "  PIMç¾åœ¨ã‚¢ã‚¯ãƒ†ã‚£ãƒ–: $($pimActiveAssignments.Count)ä»¶" -ForegroundColor Cyan
    } catch {
        Write-Host "  PIMæƒ…å ±å–å¾—ä¸å¯ï¼ˆPremium P2ãƒ©ã‚¤ã‚»ãƒ³ã‚¹å¿…è¦ï¼‰" -ForegroundColor Yellow
    }
    
    # ãƒ¬ãƒãƒ¼ãƒˆå‡ºåŠ›
    $adminRoleReport | Export-Csv "$OutputPath.csv" -Encoding UTF8 -NoTypeInformation
    Write-Host "âœ… æ¨©é™ç›£æŸ»ãƒ¬ãƒãƒ¼ãƒˆã‚’å‡ºåŠ›ã—ã¾ã—ãŸ: $OutputPath.csv" -ForegroundColor Green
    
    return @{
        AdminRoles = $adminRoleReport
        HighPrivilegedUsers = $highPrivilegedUsers
        InactiveAdmins = $inactiveAdmins
        GuestWithRoles = $guestWithRoles
    }
}
```

### è‡ªå‹•åŒ–ã•ã‚ŒãŸæ¨©é™ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚·ã‚¹ãƒ†ãƒ 

```powershell
# è‡ªå‹•æ¨©é™ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚·ã‚¹ãƒ†ãƒ 
function Start-AutomatedAccessReview {
    param(
        [int]$ReviewCycleDays = 90,  # ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚µã‚¤ã‚¯ãƒ«ï¼ˆæ—¥ï¼‰
        [string]$ApproverEmail = "security-team@organization.com"
    )
    
    Write-Host "ğŸ”„ è‡ªå‹•æ¨©é™ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚·ã‚¹ãƒ†ãƒ ã‚’é–‹å§‹ã—ã¾ã™..." -ForegroundColor Cyan
    
    # 1. ãƒ¬ãƒ“ãƒ¥ãƒ¼å¯¾è±¡ã®ç‰¹å®š
    $reviewTargets = @()
    
    # é«˜æ¨©é™ãƒ­ãƒ¼ãƒ«ä¿æœ‰è€…
    $criticalRoles = @("Global Administrator", "Privileged Role Administrator", "Security Administrator")
    foreach ($roleName in $criticalRoles) {
        $role = Get-MgDirectoryRole -Filter "displayName eq '$roleName'"
        if ($role) {
            $members = Get-MgDirectoryRoleMember -DirectoryRoleId $role.Id
            foreach ($member in $members) {
                $user = Get-MgUser -UserId $member.Id -ErrorAction SilentlyContinue
                if ($user) {
                    $reviewTargets += [PSCustomObject]@{
                        UserPrincipalName = $user.UserPrincipalName
                        DisplayName = $user.DisplayName
                        RoleName = $roleName
                        ReviewReason = "é«˜æ¨©é™ãƒ­ãƒ¼ãƒ«"
                        LastReviewed = $null  # å®Ÿè£…æ™‚ã«éå»ã®ãƒ¬ãƒ“ãƒ¥ãƒ¼æ—¥ã‚’å‚ç…§
                        NextReviewDue = (Get-Date).AddDays($ReviewCycleDays)
                    }
                }
            }
        }
    }
    
    # 2. é•·æœŸé–“æœªä½¿ç”¨ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ
    $allUsers = Get-MgUser -All | Where-Object {$_.AccountEnabled -eq $true}
    foreach ($user in $allUsers) {
        $lastSignIn = $user.SignInActivity.LastSignInDateTime
        if ($lastSignIn) {
            $daysSinceSignIn = (Get-Date) - [datetime]$lastSignIn
            if ($daysSinceSignIn.TotalDays -gt 60) {  # 60æ—¥ä»¥ä¸Šæœªã‚µã‚¤ãƒ³ã‚¤ãƒ³
                $userRoles = Get-MgUserMemberOf -UserId $user.Id | Where-Object {$_.AdditionalProperties."@odata.type" -eq "#microsoft.graph.directoryRole"}
                if ($userRoles) {
                    $reviewTargets += [PSCustomObject]@{
                        UserPrincipalName = $user.UserPrincipalName
                        DisplayName = $user.DisplayName
                        RoleName = ($userRoles.AdditionalProperties.displayName -join "; ")
                        ReviewReason = "é•·æœŸé–“æœªã‚µã‚¤ãƒ³ã‚¤ãƒ³ ($([math]::Round($daysSinceSignIn.TotalDays))æ—¥)"
                        LastReviewed = $null
                        NextReviewDue = (Get-Date)  # å³åº§ã«ãƒ¬ãƒ“ãƒ¥ãƒ¼å¿…è¦
                    }
                }
            }
        }
    }
    
    # 3. ãƒ¬ãƒ“ãƒ¥ãƒ¼é€šçŸ¥ã®é€ä¿¡
    if ($reviewTargets) {
        $reviewReport = $reviewTargets | ConvertTo-Html -Title "æ¨©é™ãƒ¬ãƒ“ãƒ¥ãƒ¼å¯¾è±¡ãƒ¦ãƒ¼ã‚¶ãƒ¼" -PreContent "<h2>å®šæœŸæ¨©é™ãƒ¬ãƒ“ãƒ¥ãƒ¼ãŒå¿…è¦ãªãƒ¦ãƒ¼ã‚¶ãƒ¼</h2>"
        
        # ãƒ¡ãƒ¼ãƒ«é€šçŸ¥æ©Ÿèƒ½ï¼ˆå®Ÿè£…æ™‚ã¯SendGridã‚„Exchange Onlineã‚’ä½¿ç”¨ï¼‰
        Write-Host "ğŸ“§ ãƒ¬ãƒ“ãƒ¥ãƒ¼é€šçŸ¥å¯¾è±¡: $($reviewTargets.Count)ä»¶" -ForegroundColor Yellow
        Write-Host "   é€šçŸ¥å…ˆ: $ApproverEmail" -ForegroundColor Yellow
        
        # CSVãƒ¬ãƒãƒ¼ãƒˆå‡ºåŠ›
        $reviewTargets | Export-Csv "C:\Reports\AccessReview_$(Get-Date -Format 'yyyyMMdd').csv" -Encoding UTF8 -NoTypeInformation
        Write-Host "âœ… ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ¬ãƒãƒ¼ãƒˆã‚’å‡ºåŠ›ã—ã¾ã—ãŸ" -ForegroundColor Green
    }
    
    return $reviewTargets
}
```

---

## ğŸ›¡ï¸ Privileged Identity Management (PIM) ã®å®Ÿè£…

### PIMåŸºæœ¬è¨­å®šã¨é‹ç”¨

**ğŸ¯ ç›®çš„**: é«˜æ¨©é™ã‚¢ã‚¯ã‚»ã‚¹ã® Just-in-Time æä¾›ã¨ã‚¢ã‚¯ã‚»ã‚¹å±¥æ­´ã®å®Œå…¨è¿½è·¡

```powershell
# PIMãƒ­ãƒ¼ãƒ«è¨­å®šã®è‡ªå‹•åŒ–
function Configure-PIMRole {
    param(
        $RoleName,
        $MaxActivationDuration = "PT8H",  # æœ€å¤§8æ™‚é–“
        $RequireApproval = $true,
        $ApproverIds = @(),
        $RequireJustification = $true,
        $RequireMFA = $true
    )
    
    try {
        # ãƒ­ãƒ¼ãƒ«å®šç¾©ã®å–å¾—
        $roleDefinition = Get-MgRoleManagementDirectoryRoleDefinition -Filter "displayName eq '$RoleName'"
        
        if (-not $roleDefinition) {
            Write-Error "ãƒ­ãƒ¼ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“: $RoleName"
            return
        }
        
        # PIMãƒãƒªã‚·ãƒ¼è¨­å®š
        $policyRules = @(
            @{
                "@odata.type" = "#microsoft.graph.unifiedRoleManagementPolicyActivationRule"
                Id = "Activation_Admin_Approval"
                EnabledRule = $RequireApproval
                Setting = @{
                    ApprovalStages = @(
                        @{
                            ApprovalStageTimeOutInDays = 1
                            IsApproverJustificationRequired = $true
                            EscalationTimeInMinutes = 0
                            PrimaryApprovers = $ApproverIds | ForEach-Object {
                                @{
                                    "@odata.type" = "#microsoft.graph.singleUser"
                                    UserId = $_
                                }
                            }
                        }
                    )
                }
            },
            @{
                "@odata.type" = "#microsoft.graph.unifiedRoleManagementPolicyActivationRule"
                Id = "Activation_Max_Duration"
                EnabledRule = $true
                Setting = @{
                    MaximumDuration = $MaxActivationDuration
                }
            },
            @{
                "@odata.type" = "#microsoft.graph.unifiedRoleManagementPolicyActivationRule"
                Id = "Activation_MFA"
                EnabledRule = $RequireMFA
            }
        )
        
        Write-Host "âœ… PIMãƒ­ãƒ¼ãƒ«è¨­å®šå®Œäº†: $RoleName" -ForegroundColor Green
        Write-Host "   æœ€å¤§æœ‰åŠ¹æ™‚é–“: $MaxActivationDuration" -ForegroundColor Cyan
        Write-Host "   æ‰¿èªå¿…é ˆ: $RequireApproval" -ForegroundColor Cyan
        Write-Host "   MFAå¿…é ˆ: $RequireMFA" -ForegroundColor Cyan
        
    } catch {
        Write-Error "PIMè¨­å®šã«å¤±æ•—ã—ã¾ã—ãŸ: $($_.Exception.Message)"
    }
}

# æ•™è‚²æ©Ÿé–¢å‘ã‘PIMè¨­å®šä¾‹
function Setup-EducationPIMRoles {
    # ITç®¡ç†è€…ã®æ‰¿èªè€…è¨­å®šï¼ˆè¤‡æ•°æ‰¿èªè€…ï¼‰
    $itManagerIds = @(
        "it-director@university.ac.jp",
        "security-manager@university.ac.jp"
    ) | ForEach-Object {
        (Get-MgUser -Filter "userPrincipalName eq '$_'").Id
    }
    
    # é‡è¦ãƒ­ãƒ¼ãƒ«ã®è¨­å®š
    Configure-PIMRole -RoleName "Global Administrator" -MaxActivationDuration "PT4H" -RequireApproval $true -ApproverIds $itManagerIds
    Configure-PIMRole -RoleName "Exchange Administrator" -MaxActivationDuration "PT8H" -RequireApproval $true -ApproverIds $itManagerIds
    Configure-PIMRole -RoleName "SharePoint Administrator" -MaxActivationDuration "PT8H" -RequireApproval $false  # æ‰¿èªä¸è¦
    Configure-PIMRole -RoleName "Teams Administrator" -MaxActivationDuration "PT8H" -RequireApproval $false
}
```

### PIMã‚¢ã‚¯ã‚»ã‚¹è¦æ±‚ã®è‡ªå‹•åŒ–

```powershell
# PIMãƒ­ãƒ¼ãƒ«æ˜‡æ ¼è¦æ±‚ã®ç°¡æ˜“åŒ–
function Request-PIMElevation {
    param(
        $RoleName,
        $DurationHours = 2,
        $Justification,
        $TicketNumber = $null
    )
    
    # ç¾åœ¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã‚’å–å¾—
    $currentUser = Get-MgContext
    if (-not $currentUser.Account) {
        Write-Error "Microsoft Graphã«æ¥ç¶šã—ã¦ãã ã•ã„"
        return
    }
    
    $userId = (Get-MgUser -Filter "userPrincipalName eq '$($currentUser.Account)'").Id
    
    # ãƒ­ãƒ¼ãƒ«å®šç¾©ã®å–å¾—
    $roleDefinition = Get-MgRoleManagementDirectoryRoleDefinition -Filter "displayName eq '$RoleName'"
    
    if (-not $roleDefinition) {
        Write-Error "ãƒ­ãƒ¼ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“: $RoleName"
        return
    }
    
    # å®Œå…¨ãªæ­£å½“åŒ–ç†ç”±ã®æ§‹ç¯‰
    $fullJustification = $Justification
    if ($TicketNumber) {
        $fullJustification += " (ãƒã‚±ãƒƒãƒˆç•ªå·: $TicketNumber)"
    }
    $fullJustification += " - è¦æ±‚æ—¥æ™‚: $(Get-Date -Format 'yyyy-MM-dd HH:mm:ss')"
    
    # PIMè¦æ±‚ã®ä½œæˆ
    $requestBody = @{
        Action = "selfActivate"
        PrincipalId = $userId
        RoleDefinitionId = $roleDefinition.Id
        DirectoryScopeId = "/"
        Justification = $fullJustification
        ScheduleInfo = @{
            StartDateTime = (Get-Date).ToString("yyyy-MM-ddTHH:mm:ss.fffZ")
            Expiration = @{
                Type = "AfterDuration"
                Duration = "PT$($DurationHours)H"
            }
        }
    }
    
    try {
        $request = New-MgRoleManagementDirectoryRoleAssignmentScheduleRequest -BodyParameter $requestBody
        
        Write-Host "âœ… PIMæ˜‡æ ¼è¦æ±‚ã‚’é€ä¿¡ã—ã¾ã—ãŸ" -ForegroundColor Green
        Write-Host "   è¦æ±‚ID: $($request.Id)" -ForegroundColor Cyan
        Write-Host "   ãƒ­ãƒ¼ãƒ«: $RoleName" -ForegroundColor Cyan
        Write-Host "   æœŸé–“: $DurationHours æ™‚é–“" -ForegroundColor Cyan
        Write-Host "   æ­£å½“åŒ–ç†ç”±: $fullJustification" -ForegroundColor Cyan
        
        # æ‰¿èªå¾…ã¡ã®å ´åˆã®ç¢ºèªæ–¹æ³•
        Write-Host "`nâ³ è¦æ±‚çŠ¶æ…‹ã®ç¢ºèªæ–¹æ³•:" -ForegroundColor Yellow
        Write-Host "   Get-MgRoleManagementDirectoryRoleAssignmentScheduleRequest -UnifiedRoleAssignmentScheduleRequestId '$($request.Id)'" -ForegroundColor Gray
        
        return $request
        
    } catch {
        Write-Error "PIMè¦æ±‚ã«å¤±æ•—ã—ã¾ã—ãŸ: $($_.Exception.Message)"
    }
}

# ä½¿ç”¨ä¾‹é–¢æ•°
function Show-PIMUsageExamples {
    Write-Host "ğŸ“‹ PIMä½¿ç”¨ä¾‹:" -ForegroundColor Cyan
    Write-Host ""
    
    Write-Host "1. ç·Šæ€¥å¯¾å¿œï¼ˆ2æ™‚é–“ã®ä¸€æ™‚çš„æ˜‡æ ¼ï¼‰:" -ForegroundColor Yellow
    Write-Host "   Request-PIMElevation -RoleName 'User Administrator' -DurationHours 2 -Justification 'ç·Šæ€¥ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚µãƒãƒ¼ãƒˆå¯¾å¿œ' -TicketNumber 'INC-2025-001'" -ForegroundColor Gray
    
    Write-Host "`n2. å®šæœŸãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ï¼ˆ8æ™‚é–“ã®æ˜‡æ ¼ï¼‰:" -ForegroundColor Yellow
    Write-Host "   Request-PIMElevation -RoleName 'Exchange Administrator' -DurationHours 8 -Justification 'æœˆæ¬¡ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ä½œæ¥­'"  -ForegroundColor Gray
    
    Write-Host "`n3. æ¨©é™ç¢ºèªï¼ˆçŸ­æ™‚é–“ã§ã®ç¢ºèªä½œæ¥­ï¼‰:" -ForegroundColor Yellow
    Write-Host "   Request-PIMElevation -RoleName 'Security Reader' -DurationHours 1 -Justification 'ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£æŸ»ç¢ºèªä½œæ¥­'" -ForegroundColor Gray
}
```

---

## ğŸ§ª å®Ÿç¿’æ¼”ç¿’: æ¨©é™ç®¡ç†ã‚·ãƒŠãƒªã‚ª

### æ¼”ç¿’1: æ•™è‚²æ©Ÿé–¢ã®æ–°å¹´åº¦æ¨©é™è¨­å®šï¼ˆ30åˆ†ï¼‰

**ğŸ¯ ã‚·ãƒŠãƒªã‚ª**: å¤§å­¦ã®æ–°å¹´åº¦é–‹å§‹ã«ä¼´ã†æ¨©é™ä½“ç³»ã®å†æ§‹ç¯‰

```markdown
ğŸ“ ã‚µãƒ³ãƒ—ãƒ«å¤§å­¦ã®æ–°å¹´åº¦æ¨©é™è¦ä»¶
- æ–°ä»»æ•™æˆ 3å: å„å­¦éƒ¨ã®ç®¡ç†æ¨©é™ãŒå¿…è¦
- å­¦å¹´ä¸»ä»» 6å: æ‹…å½“å­¦å¹´ã®å­¦ç”Ÿç®¡ç†æ¨©é™
- æ–°å…¥è·å“¡ 5å: åŸºæœ¬çš„ãªäº‹å‹™æ¨©é™
- å’æ¥­ãƒ»é€€è·è€…: æ¨©é™ç„¡åŠ¹åŒ–ãŒå¿…è¦
```

#### å®Ÿç¿’æ‰‹é †

```powershell
# 1. æ–°å¹´åº¦ç”¨ã‚«ã‚¹ã‚¿ãƒ ãƒ­ãƒ¼ãƒ«ã®ä½œæˆ
function Setup-NewAcademicYearRoles {
    Write-Host "ğŸ“ æ–°å¹´åº¦æ¨©é™è¨­å®šã‚’é–‹å§‹ã—ã¾ã™..." -ForegroundColor Cyan
    
    # å­¦éƒ¨ç®¡ç†è€…ãƒ­ãƒ¼ãƒ«
    $facultyAdminPermissions = @(
        "microsoft.directory/users/basic/update",
        "microsoft.directory/groups/members/update",
        "microsoft.office365.skypeForBusiness/allEntities/allTasks"
    )
    
    $facultyAdminRole = @{
        DisplayName = "å­¦éƒ¨ç®¡ç†è€…"
        Description = "å­¦éƒ¨å†…ã®å­¦ç”Ÿãƒ»æ•™è·å“¡ç®¡ç†æ¨©é™"
        IsEnabled = $true
        ResourceScopes = @("/")
        RolePermissions = @(@{
            AllowedResourceActions = $facultyAdminPermissions
        })
    }
    
    New-MgRoleManagementDirectoryRoleDefinition -BodyParameter $facultyAdminRole
    Write-Host "âœ… å­¦éƒ¨ç®¡ç†è€…ãƒ­ãƒ¼ãƒ«ä½œæˆå®Œäº†" -ForegroundColor Green
    
    # å­¦å¹´ä¸»ä»»ãƒ­ãƒ¼ãƒ«
    $gradeLevelPermissions = @(
        "microsoft.directory/groups/members/update",
        "microsoft.office365.exchange/allEntities/basic/read"
    )
    
    $gradeLevelRole = @{
        DisplayName = "å­¦å¹´ä¸»ä»»"
        Description = "æ‹…å½“å­¦å¹´ã®å­¦ç”Ÿç®¡ç†æ¨©é™"
        IsEnabled = $true
        ResourceScopes = @("/")
        RolePermissions = @(@{
            AllowedResourceActions = $gradeLevelPermissions
        })
    }
    
    New-MgRoleManagementDirectoryRoleDefinition -BodyParameter $gradeLevelRole
    Write-Host "âœ… å­¦å¹´ä¸»ä»»ãƒ­ãƒ¼ãƒ«ä½œæˆå®Œäº†" -ForegroundColor Green
}

# 2. æ–°ä»»æ•™æˆã¸ã®æ¨©é™ä»˜ä¸
function Assign-NewFacultyRoles {
    $newProfessors = @(
        @{Name="æ–°ä»»æ•™æˆA"; Email="prof-a@university.ac.jp"; Department="æƒ…å ±å­¦éƒ¨"},
        @{Name="æ–°ä»»æ•™æˆB"; Email="prof-b@university.ac.jp"; Department="å·¥å­¦éƒ¨"},
        @{Name="æ–°ä»»æ•™æˆC"; Email="prof-c@university.ac.jp"; Department="çµŒæ¸ˆå­¦éƒ¨"}
    )
    
    $facultyAdminRole = Get-MgDirectoryRole -Filter "displayName eq 'å­¦éƒ¨ç®¡ç†è€…'"
    
    foreach ($professor in $newProfessors) {
        $user = Get-MgUser -Filter "userPrincipalName eq '$($professor.Email)'"
        if ($user) {
            # ãƒ­ãƒ¼ãƒ«å‰²ã‚Šå½“ã¦
            New-MgDirectoryRoleMember -DirectoryRoleId $facultyAdminRole.Id -DirectoryObjectId $user.Id
            
            # éƒ¨ç½²åˆ¥ã‚°ãƒ«ãƒ¼ãƒ—ä½œæˆãƒ»è¿½åŠ 
            $deptGroupName = "$($professor.Department)-ç®¡ç†è€…"
            $deptGroup = Get-MgGroup -Filter "displayName eq '$deptGroupName'"
            if (-not $deptGroup) {
                $newGroup = @{
                    DisplayName = $deptGroupName
                    Description = "$($professor.Department)ã®ç®¡ç†è€…ã‚°ãƒ«ãƒ¼ãƒ—"
                    SecurityEnabled = $true
                    MailEnabled = $false
                }
                $deptGroup = New-MgGroup -BodyParameter $newGroup
            }
            
            New-MgGroupMember -GroupId $deptGroup.Id -DirectoryObjectId $user.Id
            Write-Host "âœ… $($professor.Name) ã«å­¦éƒ¨ç®¡ç†æ¨©é™ã‚’ä»˜ä¸ã—ã¾ã—ãŸ" -ForegroundColor Green
        }
    }
}

# å®Ÿç¿’å®Ÿè¡Œ
Setup-NewAcademicYearRoles
Assign-NewFacultyRoles
```

### æ¼”ç¿’2: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆå¯¾å¿œï¼ˆ20åˆ†ï¼‰

**ğŸ¯ ã‚·ãƒŠãƒªã‚ª**: ä¸å¯©ãªã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£æ¤œå‡ºæ™‚ã®ç·Šæ€¥æ¨©é™ç„¡åŠ¹åŒ–

```powershell
# ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆå¯¾å¿œè‡ªå‹•åŒ–
function Handle-SecurityIncident {
    param(
        $SuspiciousUserEmail,
        $IncidentId,
        $Severity = "Medium"  # Low, Medium, High, Critical
    )
    
    Write-Host "ğŸš¨ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆå¯¾å¿œé–‹å§‹: $IncidentId" -ForegroundColor Red
    
    $user = Get-MgUser -Filter "userPrincipalName eq '$SuspiciousUserEmail'"
    if (-not $user) {
        Write-Error "ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“: $SuspiciousUserEmail"
        return
    }
    
    # é‡è¦åº¦ã«å¿œã˜ãŸå¯¾å¿œãƒ¬ãƒ™ãƒ«
    switch ($Severity) {
        "Critical" {
            # å³åº§ã«ã‚¢ã‚«ã‚¦ãƒ³ãƒˆç„¡åŠ¹åŒ–
            Update-MgUser -UserId $user.Id -AccountEnabled $false
            Write-Host "ğŸ”’ ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ç„¡åŠ¹åŒ–ã—ã¾ã—ãŸ: $SuspiciousUserEmail" -ForegroundColor Red
            
            # å…¨ã¦ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’å¼·åˆ¶çµ‚äº†
            Revoke-MgUserSignInSession -UserId $user.Id
            Write-Host "ğŸ”„ å…¨ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’çµ‚äº†ã—ã¾ã—ãŸ" -ForegroundColor Yellow
            
            # ç®¡ç†è€…æ¨©é™ã®ä¸€æ™‚åœæ­¢
            $userRoles = Get-MgUserMemberOf -UserId $user.Id | Where-Object {$_.AdditionalProperties."@odata.type" -eq "#microsoft.graph.directoryRole"}
            foreach ($role in $userRoles) {
                Remove-MgDirectoryRoleMember -DirectoryRoleId $role.Id -DirectoryObjectId $user.Id
                Write-Host "âš ï¸ ç®¡ç†è€…æ¨©é™ã‚’å‰Šé™¤: $($role.AdditionalProperties.displayName)" -ForegroundColor Yellow
            }
        }
        
        "High" {
            # MFAå¼·åˆ¶ãƒªã‚»ãƒƒãƒˆ
            Reset-MgUserAuthenticationMethod -UserId $user.Id
            Write-Host "ğŸ” MFAè¨­å®šã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸ" -ForegroundColor Orange
            
            # ä¸€æ™‚çš„ãªæ¨©é™åˆ¶é™
            $restrictedGroup = Get-MgGroup -Filter "displayName eq 'åˆ¶é™ãƒ¦ãƒ¼ã‚¶ãƒ¼'"
            if ($restrictedGroup) {
                New-MgGroupMember -GroupId $restrictedGroup.Id -DirectoryObjectId $user.Id
                Write-Host "âš ï¸ åˆ¶é™ã‚°ãƒ«ãƒ¼ãƒ—ã«è¿½åŠ ã—ã¾ã—ãŸ" -ForegroundColor Orange
            }
        }
        
        "Medium" {
            # ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¼·åˆ¶å¤‰æ›´
            Update-MgUser -UserId $user.Id -PasswordProfile @{
                ForceChangePasswordNextSignIn = $true
                Password = New-RandomPassword
            }
            Write-Host "ğŸ”‘ ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆã‚’è¨­å®šã—ã¾ã—ãŸ" -ForegroundColor Yellow
        }
    }
    
    # ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆãƒ­ã‚°è¨˜éŒ²
    $incidentLog = @{
        Timestamp = Get-Date
        IncidentId = $IncidentId
        UserEmail = $SuspiciousUserEmail
        Severity = $Severity
        ActionsPerformed = "AccountDisabled, SessionRevoked, RolesRemoved"
        Operator = (Get-MgContext).Account
    }
    
    $incidentLog | ConvertTo-Json | Add-Content "C:\SecurityLogs\incident_$IncidentId.json"
    Write-Host "ğŸ“ ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆãƒ­ã‚°ã‚’è¨˜éŒ²ã—ã¾ã—ãŸ" -ForegroundColor Cyan
}

# ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ç”Ÿæˆãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°
function New-RandomPassword {
    $chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*"
    return (-join ((1..12) | ForEach-Object { $chars[(Get-Random -Maximum $chars.Length)] }))
}

# ä½¿ç”¨ä¾‹
# Handle-SecurityIncident -SuspiciousUserEmail "suspicious.user@company.com" -IncidentId "INC-2025-001" -Severity "Critical"
```

### æ¼”ç¿’3: æ¨©é™æœ€é©åŒ–ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆï¼ˆ40åˆ†ï¼‰

**ğŸ¯ ã‚·ãƒŠãƒªã‚ª**: çµ„ç¹”å…¨ä½“ã®æ¨©é™è¦‹ç›´ã—ã¨ã‚³ã‚¹ãƒˆæœ€é©åŒ–

```powershell
# æ¨©é™æœ€é©åŒ–åˆ†æã‚·ã‚¹ãƒ†ãƒ 
function Analyze-PermissionOptimization {
    Write-Host "ğŸ” æ¨©é™æœ€é©åŒ–åˆ†æã‚’é–‹å§‹ã—ã¾ã™..." -ForegroundColor Cyan
    
    # 1. éå‰°æ¨©é™ã®æ¤œå‡º
    $overPrivilegedUsers = @()
    $allUsers = Get-MgUser -All
    
    foreach ($user in $allUsers) {
        $userRoles = Get-MgUserMemberOf -UserId $user.Id | Where-Object {$_.AdditionalProperties."@odata.type" -eq "#microsoft.graph.directoryRole"}
        
        if ($userRoles.Count -gt 2) {  # 3å€‹ä»¥ä¸Šã®ãƒ­ãƒ¼ãƒ« = è¦ç¢ºèª
            $lastSignIn = $user.SignInActivity.LastSignInDateTime
            $overPrivilegedUsers += [PSCustomObject]@{
                UserPrincipalName = $user.UserPrincipalName
                DisplayName = $user.DisplayName
                Department = $user.Department
                JobTitle = $user.JobTitle
                RoleCount = $userRoles.Count
                Roles = ($userRoles.AdditionalProperties.displayName -join "; ")
                LastSignIn = $lastSignIn
                OptimizationPriority = if (-not $lastSignIn -or ((Get-Date) - [datetime]$lastSignIn).TotalDays -gt 90) { "é«˜" } else { "ä¸­" }
            }
        }
    }
    
    # 2. æœªä½¿ç”¨ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã®æ¤œå‡º
    $licenses = Get-MgSubscribedSku
    $unusedLicenses = @()
    
    foreach ($license in $licenses) {
        $availableUnits = $license.PrepaidUnits.Enabled - $license.ConsumedUnits
        if ($availableUnits -gt 0) {
            $costPerMonth = Get-LicenseCost -SkuId $license.SkuId  # æ¶ç©ºã®é–¢æ•°
            $unusedLicenses += [PSCustomObject]@{
                SkuPartNumber = $license.SkuPartNumber
                UnusedUnits = $availableUnits
                EstimatedMonthlySavings = $availableUnits * $costPerMonth
            }
        }
    }
    
    # 3. æ¨å¥¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³
    Write-Host "`nğŸ“Š æœ€é©åŒ–åˆ†æçµæœ:" -ForegroundColor Green
    Write-Host "   éå‰°æ¨©é™ãƒ¦ãƒ¼ã‚¶ãƒ¼: $($overPrivilegedUsers.Count)å" -ForegroundColor Yellow
    
    if ($overPrivilegedUsers) {
        Write-Host "`nâš ï¸ æ¨©é™è¦‹ç›´ã—æ¨å¥¨ãƒ¦ãƒ¼ã‚¶ãƒ¼:" -ForegroundColor Yellow
        $overPrivilegedUsers | Where-Object {$_.OptimizationPriority -eq "é«˜"} | ForEach-Object {
            Write-Host "   - $($_.UserPrincipalName): $($_.RoleCount)å€‹ã®ãƒ­ãƒ¼ãƒ«" -ForegroundColor Red
        }
    }
    
    # 4. æœ€é©åŒ–è¨ˆç”»ã®ç”Ÿæˆ
    $optimizationPlan = @{
        AnalysisDate = Get-Date
        OverPrivilegedUsers = $overPrivilegedUsers
        UnusedLicenses = $unusedLicenses
        RecommendedActions = @(
            "é«˜å„ªå…ˆåº¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ¨©é™ãƒ¬ãƒ“ãƒ¥ãƒ¼å®Ÿæ–½",
            "90æ—¥ä»¥ä¸Šæœªã‚µã‚¤ãƒ³ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ¨©é™ç„¡åŠ¹åŒ–",
            "æœªä½¿ç”¨ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã®å‰Šæ¸›æ¤œè¨",
            "å‹•çš„ã‚°ãƒ«ãƒ¼ãƒ—ã«ã‚ˆã‚‹æ¨©é™è‡ªå‹•åŒ–"
        )
        EstimatedSavings = ($unusedLicenses | Measure-Object EstimatedMonthlySavings -Sum).Sum
    }
    
    # ãƒ¬ãƒãƒ¼ãƒˆå‡ºåŠ›
    $optimizationPlan | ConvertTo-Json -Depth 3 | Out-File "C:\Reports\PermissionOptimization_$(Get-Date -Format 'yyyyMMdd').json"
    $overPrivilegedUsers | Export-Csv "C:\Reports\OverPrivilegedUsers_$(Get-Date -Format 'yyyyMMdd').csv" -Encoding UTF8 -NoTypeInformation
    
    Write-Host "âœ… æœ€é©åŒ–åˆ†æå®Œäº† - ãƒ¬ãƒãƒ¼ãƒˆã‚’å‡ºåŠ›ã—ã¾ã—ãŸ" -ForegroundColor Green
    return $optimizationPlan
}

# æ¶ç©ºã®ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã‚³ã‚¹ãƒˆè¨ˆç®—é–¢æ•°
function Get-LicenseCost {
    param($SkuId)
    # å®Ÿéš›ã®å®Ÿè£…ã§ã¯ Azure Cost Management API ã¾ãŸã¯ ä¾¡æ ¼è¡¨ã‚’å‚ç…§
    $costMap = @{
        "STANDARDPACK" = 500      # Office 365 E1: 500å††/æœˆ
        "ENTERPRISEPACK" = 1200   # Office 365 E3: 1200å††/æœˆ
        "SPE_E5" = 3000          # Microsoft 365 E5: 3000å††/æœˆ
    }
    return $costMap[$SkuId] ?? 0
}

# å®Ÿç¿’å®Ÿè¡Œ
$optimizationResults = Analyze-PermissionOptimization
```

---

## ğŸ› ï¸ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚ˆãã‚ã‚‹æ¨©é™å•é¡Œã¨è§£æ±ºæ–¹æ³•

#### å•é¡Œ1: æ¨©é™å‰²ã‚Šå½“ã¦ã‚¨ãƒ©ãƒ¼

**ç—‡çŠ¶**: "Insufficient privileges to complete the operation" ã‚¨ãƒ©ãƒ¼

**åŸå› ã¨è§£æ±º**:

```powershell
# æ¨©é™ä¸è¶³ã®è¨ºæ–­ã¨è§£æ±º
function Diagnose-PermissionIssue {
    param($UserEmail, $TargetRole)
    
    Write-Host "ğŸ” æ¨©é™å•é¡Œã®è¨ºæ–­ä¸­..." -ForegroundColor Cyan
    
    # 1. ç¾åœ¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼æ¨©é™ç¢ºèª
    $currentUser = Get-MgUser -Filter "userPrincipalName eq '$UserEmail'"
    if (-not $currentUser) {
        Write-Error "ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“: $UserEmail"
        return
    }
    
    $currentRoles = Get-MgUserMemberOf -UserId $currentUser.Id | Where-Object {$_.AdditionalProperties."@odata.type" -eq "#microsoft.graph.directoryRole"}
    
    Write-Host "ğŸ“‹ ç¾åœ¨ã®æ¨©é™:" -ForegroundColor Yellow
    $currentRoles.AdditionalProperties.displayName | ForEach-Object {
        Write-Host "   - $_" -ForegroundColor Gray
    }
    
    # 2. å¿…è¦æ¨©é™ã®ç¢ºèª
    $roleRequirements = @{
        "User Administrator" = @("Privileged Role Administrator", "Global Administrator")
        "Exchange Administrator" = @("Global Administrator")
        "Security Administrator" = @("Privileged Role Administrator", "Global Administrator")
    }
    
    if ($roleRequirements.ContainsKey($TargetRole)) {
        $requiredRoles = $roleRequirements[$TargetRole]
        $hasRequiredRole = $false
        
        foreach ($requiredRole in $requiredRoles) {
            if ($currentRoles.AdditionalProperties.displayName -contains $requiredRole) {
                $hasRequiredRole = $true
                break
            }
        }
        
        if (-not $hasRequiredRole) {
            Write-Host "âŒ æ¨©é™ä¸è¶³: $TargetRole ã®å‰²ã‚Šå½“ã¦ã«ã¯ä»¥ä¸‹ã®æ¨©é™ãŒå¿…è¦ã§ã™:" -ForegroundColor Red
            $requiredRoles | ForEach-Object {
                Write-Host "   - $_" -ForegroundColor Red
            }
        } else {
            Write-Host "âœ… æ¨©é™ã¯å……åˆ†ã§ã™" -ForegroundColor Green
        }
    }
    
    # 3. PIMã«ã‚ˆã‚‹ä¸€æ™‚æ˜‡æ ¼ã®ç¢ºèª
    try {
        $pimEligible = Get-MgRoleManagementDirectoryRoleEligibilityScheduleInstance -Filter "principalId eq '$($currentUser.Id)'"
        if ($pimEligible) {
            Write-Host "â³ PIMã§åˆ©ç”¨å¯èƒ½ãªæ¨©é™:" -ForegroundColor Cyan
            $pimEligible | ForEach-Object {
                $roleDefinition = Get-MgRoleManagementDirectoryRoleDefinition -UnifiedRoleDefinitionId $_.RoleDefinitionId
                Write-Host "   - $($roleDefinition.DisplayName)" -ForegroundColor Cyan
            }
        }
    } catch {
        Write-Host "â„¹ï¸ PIMæƒ…å ±ã®å–å¾—ã«å¤±æ•—ï¼ˆPremium P2ãƒ©ã‚¤ã‚»ãƒ³ã‚¹å¿…è¦ï¼‰" -ForegroundColor Yellow
    }
}

# ä½¿ç”¨ä¾‹
# Diagnose-PermissionIssue -UserEmail "admin@company.com" -TargetRole "User Administrator"
```

#### å•é¡Œ2: æ¡ä»¶ä»˜ãã‚¢ã‚¯ã‚»ã‚¹ã«ã‚ˆã‚‹ãƒ–ãƒ­ãƒƒã‚¯

**ç—‡çŠ¶**: "Access blocked by conditional access policy" ã‚¨ãƒ©ãƒ¼

**è§£æ±ºæ‰‹é †**:

```powershell
# æ¡ä»¶ä»˜ãã‚¢ã‚¯ã‚»ã‚¹ã®ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
function Troubleshoot-ConditionalAccess {
    param($UserEmail, $ApplicationName = "Microsoft 365")
    
    $user = Get-MgUser -Filter "userPrincipalName eq '$UserEmail'"
    
    # 1. é©ç”¨ã•ã‚Œã¦ã„ã‚‹ãƒãƒªã‚·ãƒ¼ã®ç¢ºèª
    $caPolicy = Get-MgIdentityConditionalAccessPolicy -All
    $applicablePolicies = @()
    
    foreach ($policy in $caPolicy) {
        # ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå¯¾è±¡ã«å«ã¾ã‚Œã¦ã„ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
        $userGroups = Get-MgUserMemberOf -UserId $user.Id
        $userGroupIds = $userGroups.Id
        
        $isTargeted = $false
        if ($policy.Conditions.Users.IncludeUsers -contains $user.Id -or 
            $policy.Conditions.Users.IncludeUsers -contains "All") {
            $isTargeted = $true
        }
        
        if ($policy.Conditions.Users.IncludeGroups) {
            foreach ($groupId in $policy.Conditions.Users.IncludeGroups) {
                if ($userGroupIds -contains $groupId) {
                    $isTargeted = $true
                    break
                }
            }
        }
        
        if ($isTargeted) {
            $applicablePolicies += [PSCustomObject]@{
                PolicyName = $policy.DisplayName
                State = $policy.State
                GrantControls = ($policy.GrantControls.BuiltInControls -join ", ")
                SessionControls = if ($policy.SessionControls) { "è¨­å®šã‚ã‚Š" } else { "ãªã—" }
            }
        }
    }
    
    Write-Host "ğŸ“‹ é©ç”¨ã•ã‚Œã‚‹æ¡ä»¶ä»˜ãã‚¢ã‚¯ã‚»ã‚¹ãƒãƒªã‚·ãƒ¼:" -ForegroundColor Yellow
    $applicablePolicies | Format-Table -AutoSize
    
    # 2. è§£æ±ºæ¡ˆã®æç¤º
    Write-Host "`nğŸ’¡ è§£æ±ºæ¡ˆ:" -ForegroundColor Green
    foreach ($policy in $applicablePolicies | Where-Object {$_.State -eq "enabled"}) {
        Write-Host "   ãƒãƒªã‚·ãƒ¼: $($policy.PolicyName)" -ForegroundColor Cyan
        switch -Regex ($policy.GrantControls) {
            "mfa" { 
                Write-Host "     â†’ MFAè¨­å®šã‚’å®Œäº†ã—ã¦ãã ã•ã„" -ForegroundColor Gray 
            }
            "compliantDevice" { 
                Write-Host "     â†’ ãƒ‡ãƒã‚¤ã‚¹ã‚’Intuneæº–æ‹ çŠ¶æ…‹ã«ã—ã¦ãã ã•ã„" -ForegroundColor Gray 
            }
            "domainJoinedDevice" { 
                Write-Host "     â†’ ãƒ‰ãƒ¡ã‚¤ãƒ³å‚åŠ ãƒ‡ãƒã‚¤ã‚¹ã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„" -ForegroundColor Gray 
            }
            "approvedApplication" { 
                Write-Host "     â†’ æ‰¿èªã•ã‚ŒãŸã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„" -ForegroundColor Gray 
            }
            default { 
                Write-Host "     â†’ ç®¡ç†è€…ã«ç¢ºèªã—ã¦ãã ã•ã„: $($policy.GrantControls)" -ForegroundColor Gray 
            }
        }
    }
}
```

#### å•é¡Œ3: PIMæ˜‡æ ¼ãŒæ‰¿èªã•ã‚Œãªã„

**ç—‡çŠ¶**: PIMè¦æ±‚ãŒé•·æ™‚é–“ãƒšãƒ³ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹

**è§£æ±ºæ‰‹é †**:

```powershell
# PIMæ‰¿èªçŠ¶æ³ã®ç¢ºèªã¨å‚¬ä¿ƒ
function Check-PIMApprovalStatus {
    param($RequestId)
    
    try {
        # è¦æ±‚ã®è©³ç´°ç¢ºèª
        $request = Get-MgRoleManagementDirectoryRoleAssignmentScheduleRequest -UnifiedRoleAssignmentScheduleRequestId $RequestId
        
        Write-Host "ğŸ“‹ PIMè¦æ±‚çŠ¶æ³:" -ForegroundColor Cyan
        Write-Host "   è¦æ±‚ID: $($request.Id)" -ForegroundColor Gray
        Write-Host "   çŠ¶æ…‹: $($request.Status)" -ForegroundColor Gray
        Write-Host "   ä½œæˆæ—¥æ™‚: $($request.CreatedDateTime)" -ForegroundColor Gray
        Write-Host "   æ­£å½“åŒ–ç†ç”±: $($request.Justification)" -ForegroundColor Gray
        
        # ãƒ­ãƒ¼ãƒ«è©³ç´°ã®å–å¾—
        $roleDefinition = Get-MgRoleManagementDirectoryRoleDefinition -UnifiedRoleDefinitionId $request.RoleDefinitionId
        Write-Host "   å¯¾è±¡ãƒ­ãƒ¼ãƒ«: $($roleDefinition.DisplayName)" -ForegroundColor Gray
        
        # æ‰¿èªè€…ã®ç¢ºèª
        $rolePolicy = Get-MgRoleManagementDirectoryRoleAssignmentPolicy -UnifiedRoleAssignmentPolicyId $request.RoleDefinitionId
        if ($rolePolicy.Rules) {
            $approvalRule = $rolePolicy.Rules | Where-Object { $_."@odata.type" -match "approval" }
            if ($approvalRule) {
                Write-Host "`nğŸ‘¥ æ‰¿èªè€…æƒ…å ±:" -ForegroundColor Yellow
                # æ‰¿èªè€…ã®è©³ç´°è¡¨ç¤ºï¼ˆå®Ÿè£…ä¾å­˜ï¼‰
            }
        }
        
        # çŠ¶æ…‹åˆ¥ã®ã‚¢ãƒ‰ãƒã‚¤ã‚¹
        switch ($request.Status) {
            "PendingApproval" {
                Write-Host "`nâ³ æ‰¿èªå¾…ã¡çŠ¶æ…‹ã§ã™" -ForegroundColor Yellow
                Write-Host "   æ‰¿èªè€…ã«ç›´æ¥é€£çµ¡ã™ã‚‹ã“ã¨ã‚’æ¤œè¨ã—ã¦ãã ã•ã„" -ForegroundColor Gray
            }
            "Approved" {
                Write-Host "`nâœ… æ‰¿èªæ¸ˆã¿ã§ã™ - ãƒ­ãƒ¼ãƒ«ãŒæœ‰åŠ¹åŒ–ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„" -ForegroundColor Green
            }
            "Denied" {
                Write-Host "`nâŒ æ‹’å¦ã•ã‚Œã¾ã—ãŸ - æ­£å½“åŒ–ç†ç”±ã‚’è¦‹ç›´ã—ã¦å†ç”³è«‹ã—ã¦ãã ã•ã„" -ForegroundColor Red
            }
            "TimedOut" {
                Write-Host "`nâ° ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã—ã¾ã—ãŸ - æ–°ã—ã„è¦æ±‚ã‚’ä½œæˆã—ã¦ãã ã•ã„" -ForegroundColor Red
            }
        }
        
    } catch {
        Write-Error "PIMè¦æ±‚ã®ç¢ºèªã«å¤±æ•—ã—ã¾ã—ãŸ: $($_.Exception.Message)"
    }
}

# PIMè¦æ±‚ã®ä¸€è¦§è¡¨ç¤º
function Show-MyPIMRequests {
    $currentUserId = (Get-MgUser -Filter "userPrincipalName eq '$((Get-MgContext).Account)'").Id
    
    $myRequests = Get-MgRoleManagementDirectoryRoleAssignmentScheduleRequest -Filter "principalId eq '$currentUserId'" | 
                  Sort-Object CreatedDateTime -Descending |
                  Select-Object -First 10
    
    Write-Host "ğŸ“‹ æœ€è¿‘ã®PIMè¦æ±‚ï¼ˆä¸Šä½10ä»¶ï¼‰:" -ForegroundColor Cyan
    $myRequests | ForEach-Object {
        $roleDefinition = Get-MgRoleManagementDirectoryRoleDefinition -UnifiedRoleDefinitionId $_.RoleDefinitionId
        Write-Host "   $($_.CreatedDateTime): $($roleDefinition.DisplayName) - $($_.Status)" -ForegroundColor Gray
    }
}
```

---

## âœ… å­¦ç¿’æˆæœã®ç¢ºèª

### ç¿’å¾—ã‚¹ã‚­ãƒ«ãƒã‚§ãƒƒã‚¯

ã“ã®ç¯€ã‚’å®Œäº†ã—ãŸã‚‰ã€ä»¥ä¸‹ã®é …ç›®ã«ã¤ã„ã¦å®Ÿéš›ã«æ“ä½œã§ãã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼š

- [ ] **ãƒ­ãƒ¼ãƒ«ä½“ç³»ã®ç†è§£**: çµ„ç¹”è¦ä»¶ã«é©ã—ãŸç®¡ç†è€…ãƒ­ãƒ¼ãƒ«ã®é¸æŠãƒ»è¨­è¨ˆ
- [ ] **æœ€å°æ¨©é™ã®å®Ÿè£…**: æ¥­å‹™ã«å¿…è¦ãªæœ€å°é™ã®æ¨©é™ä»˜ä¸
- [ ] **ã‚«ã‚¹ã‚¿ãƒ ãƒ­ãƒ¼ãƒ«ä½œæˆ**: æ¨™æº–ãƒ­ãƒ¼ãƒ«ã§ã¯å¯¾å¿œã§ããªã„è¦ä»¶ã¸ã®å¯¾å¿œ
- [ ] **PIMå°å…¥ãƒ»é‹ç”¨**: Just-in-Time ã‚¢ã‚¯ã‚»ã‚¹ã®å®Ÿè£…ã¨ç®¡ç†
- [ ] **æ¨©é™ç›£æŸ»**: å®šæœŸçš„ãªæ£šå¸ã—ã¨æœ€é©åŒ–ã®å®Ÿæ–½
- [ ] **ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆå¯¾å¿œ**: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å•é¡Œç™ºç”Ÿæ™‚ã®è¿…é€Ÿãªæ¨©é™åˆ¶å¾¡
- [ ] **ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°**: æ¨©é™é–¢é€£å•é¡Œã®è¨ºæ–­ãƒ»è§£æ±º

### å®Ÿè·µèª²é¡Œ: åŒ…æ‹¬çš„æ¨©é™ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ æ§‹ç¯‰

å®Ÿéš›ã®çµ„ç¹”ã‚’æƒ³å®šã—ãŸç·åˆçš„ãªèª²é¡Œã«å–ã‚Šçµ„ã‚“ã§ãã ã•ã„ï¼š

```markdown
ğŸ¯ ç·åˆèª²é¡Œ: å¤šæ‹ ç‚¹æ•™è‚²æ©Ÿé–¢ã®æ¨©é™ç®¡ç†çµ±åˆ

## èƒŒæ™¯
3ã¤ã®ã‚­ãƒ£ãƒ³ãƒ‘ã‚¹ã‚’æŒã¤å¤§å­¦ãŒ Microsoft 365 ã‚’çµ±åˆå°å…¥ã€‚
å„ã‚­ãƒ£ãƒ³ãƒ‘ã‚¹ã®ç‹¬è‡ªé‹ç”¨ã‹ã‚‰çµ±ä¸€çš„ãªæ¨©é™ç®¡ç†ä½“åˆ¶ã¸ã®ç§»è¡ŒãŒå¿…è¦ã€‚

## è¦ä»¶
- æœ¬éƒ¨: å…¨ä½“çµ±åˆ¶ã€ãƒãƒªã‚·ãƒ¼ç­–å®š
- å„ã‚­ãƒ£ãƒ³ãƒ‘ã‚¹: ç‹¬è‡ªã®æ•™å‹™ãƒ»å­¦å‹™ç®¡ç†
- å­¦éƒ¨æ¨ªæ–­: ç ”ç©¶ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç®¡ç†
- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£: çµ±ä¸€åŸºæº–ã€ç›£æŸ»å¯¾å¿œ

## å®Ÿæ–½å†…å®¹
1. 3å±¤æ¨©é™ä½“ç³»ã®è¨­è¨ˆï¼ˆæœ¬éƒ¨ãƒ»ã‚­ãƒ£ãƒ³ãƒ‘ã‚¹ãƒ»å­¦éƒ¨ï¼‰
2. å‹•çš„ã‚°ãƒ«ãƒ¼ãƒ—ã«ã‚ˆã‚‹è‡ªå‹•æ¨©é™ç®¡ç†
3. PIMå°å…¥ã«ã‚ˆã‚‹é«˜æ¨©é™ç®¡ç†
4. åŒ…æ‹¬çš„ç›£æŸ»ã‚·ã‚¹ãƒ†ãƒ ã®æ§‹ç¯‰
5. é‹ç”¨æ‰‹é †æ›¸ãƒ»ç·Šæ€¥æ™‚å¯¾å¿œè¨ˆç”»ã®ç­–å®š

## æˆæœç‰©
- æ¨©é™è¨­è¨ˆæ›¸ï¼ˆPowerShellã‚¹ã‚¯ãƒªãƒ—ãƒˆå«ã‚€ï¼‰
- é‹ç”¨æ‰‹é †æ›¸ï¼ˆæ—¥å¸¸ãƒ»ç·Šæ€¥æ™‚ï¼‰
- ç›£æŸ»ãƒ¬ãƒãƒ¼ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
- ãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘ã‚¬ã‚¤ãƒ€ãƒ³ã‚¹è³‡æ–™
```

---

## ğŸš€ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

ã“ã®ç¯€ã‚’å®Œäº†ã—ãŸã‚‰ã€ä»¥ä¸‹ã®å­¦ç¿’ã«é€²ã‚€ã“ã¨ã‚’æ¨å¥¨ã—ã¾ã™ï¼š

### æ¨å¥¨å­¦ç¿’ãƒ‘ã‚¹

<!-- 1. **[ç¬¬5ç« : ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã¨ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹](../05-security-compliance/)** -->
- é«˜åº¦ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ©Ÿèƒ½ã¨ã®é€£æº
- ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹è¦ä»¶ã¸ã®å¯¾å¿œ

<!-- 2. **[ç¬¬6ç« : ãƒ‡ãƒã‚¤ã‚¹ç®¡ç†](../06-device-management/)** -->
- Intune ã«ã‚ˆã‚‹åŒ…æ‹¬çš„ãªãƒ‡ãƒã‚¤ã‚¹åˆ¶å¾¡
- æ¡ä»¶ä»˜ãã‚¢ã‚¯ã‚»ã‚¹ã¨ã®çµ±åˆ

<!-- 3. **[ç¬¬8ç« : é‹ç”¨ç›£è¦–ã¨ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°](../08-monitoring-troubleshooting/)** -->
- ç¶™ç¶šçš„ãªæ¨©é™ç›£è¦–ã‚·ã‚¹ãƒ†ãƒ 
- è‡ªå‹•åŒ–ã•ã‚ŒãŸå•é¡Œæ¤œå‡ºãƒ»å¯¾å¿œ

### ç™ºå±•å­¦ç¿’

- **Microsoft Entra ID Governance**: ã‚ˆã‚Šé«˜åº¦ãªã‚¢ã‚¤ãƒ‡ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚¬ãƒãƒŠãƒ³ã‚¹
- **Azure Sentinel**: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æƒ…å ±ã‚¤ãƒ™ãƒ³ãƒˆç®¡ç†ï¼ˆSIEMï¼‰
- **Microsoft Purview**: ãƒ‡ãƒ¼ã‚¿ã‚¬ãƒãƒŠãƒ³ã‚¹ã¨ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹
- **Zero Trust Architecture**: ã‚¼ãƒ­ãƒˆãƒ©ã‚¹ãƒˆã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®å®Ÿè£…

---

## ğŸ“š å‚è€ƒãƒªã‚½ãƒ¼ã‚¹

### Microsoftå…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [Microsoft Entra ID ã®çµ„ã¿è¾¼ã¿ãƒ­ãƒ¼ãƒ«](https://docs.microsoft.com/ja-jp/azure/active-directory/roles/permissions-reference)
- [Privileged Identity Management](https://docs.microsoft.com/ja-jp/azure/active-directory/privileged-identity-management/)
- [æ¡ä»¶ä»˜ãã‚¢ã‚¯ã‚»ã‚¹](https://docs.microsoft.com/ja-jp/azure/active-directory/conditional-access/)
- [Microsoft Graph PowerShell SDK](https://docs.microsoft.com/en-us/powershell/microsoftgraph/)

### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

- [Microsoft ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹](https://docs.microsoft.com/ja-jp/security/)
- [Azure AD ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£é‹ç”¨ã‚¬ã‚¤ãƒ‰](https://docs.microsoft.com/ja-jp/azure/active-directory/fundamentals/security-operations-introduction)
- [ç‰¹æ¨©ã‚¢ã‚¯ã‚»ã‚¹ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—](https://docs.microsoft.com/ja-jp/azure/active-directory/roles/security-planning)

### å®Ÿç”¨ãƒ„ãƒ¼ãƒ«ãƒ»ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ

<!-- - [æ¨©é™ç®¡ç†ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ](../../appendices/checklists/role-management-checklist.md) -->
<!-- - [PowerShellæ¨©é™ç®¡ç†ã‚¹ã‚¯ãƒªãƒ—ãƒˆé›†](../../appendices/powershell-commands.md#æ¨©é™ç®¡ç†) -->
<!-- - [æ¨©é™è¨­è¨ˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ](../../appendices/templates/role-design-template.xlsx) -->

---

*ğŸ“… æœ€çµ‚æ›´æ–°: 2025å¹´6æœˆ2æ—¥*  
*âœï¸ æ›´æ–°è€…: Microsoft 365 ãƒãƒ³ãƒ‰ãƒ–ãƒƒã‚¯ç·¨é›†ãƒãƒ¼ãƒ *  
*ğŸ“– å¯¾è±¡ãƒãƒ¼ã‚¸ãƒ§ãƒ³: Microsoft 365 (2025å¹´6æœˆç‰ˆ) 